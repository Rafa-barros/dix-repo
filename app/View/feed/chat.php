
<div class="all">
    <nav class="nav">
        <a class="a-logo-dix" href="/feed"><img class="logo-dix" src="/app/View/assets/css/img/logo_blue.png" alt="logo"></a> 
        <div class="features-containers">
            <a href="/feed"><i class="fas fa-home"></i></a> 
            <a href="/chat"><i class="fas fa-comments"></i></a>
            <a href=""><i class="fas fa-bell "></i></a>
        </div>
    </nav>
    <div class="main-container">
    <div class="contatos">
        <div class="contatos-title-container">
            <h2>Contatos</h2>
            <i class="fas fa-search busca-contato"></i>
        </div>
        
        <div class="contact-list">
            <div class="contato">
                <img class="foto-contato" src="/app/View/assets/css/img/Caio.jpg" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Caio Brandini</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/130721573_2447514392060467_2518719859666796177_o.jpg?_nc_cat=108&ccb=2&_nc_sid=09cbfe&_nc_ohc=mYgZ_iaZMsgAX8OxWrV&_nc_ht=scontent.fcpq4-1.fna&oh=ebed84440b7f479a097acf165ec20a6f&oe=60368BEF" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Vinícius Venturini</span>
                    <p class="contact-last-message">Lorem, ipsum dolor.</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/48376083_1774848979290448_2227168575674646528_n.jpg?_nc_cat=103&ccb=2&_nc_sid=09cbfe&_nc_ohc=Cl4R69na_vQAX-XXNBd&_nc_ht=scontent.fcpq4-1.fna&oh=076a06f455381386ef3de739dec6d679&oe=6035D944" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Marcus Vinícius</span>
                    <p class="contact-last-message">Lorem ipsum dolor...</p>
                </div>
            </div>

            <div class="contato">
                <img class="foto-contato" src="/app/View/assets/css/img/Caio.jpg" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Joana Paula</span>
                    <p class="contact-last-message">Lorem.</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/130721573_2447514392060467_2518719859666796177_o.jpg?_nc_cat=108&ccb=2&_nc_sid=09cbfe&_nc_ohc=mYgZ_iaZMsgAX8OxWrV&_nc_ht=scontent.fcpq4-1.fna&oh=ebed84440b7f479a097acf165ec20a6f&oe=60368BEF" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Gabriel Costa</span>
                    <p class="contact-last-message">Lorem, ipsum dolor.</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/48376083_1774848979290448_2227168575674646528_n.jpg?_nc_cat=103&ccb=2&_nc_sid=09cbfe&_nc_ohc=Cl4R69na_vQAX-XXNBd&_nc_ht=scontent.fcpq4-1.fna&oh=076a06f455381386ef3de739dec6d679&oe=6035D944" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Marcus souza</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>

            <div class="contato">
                <img class="foto-contato" src="/app/View/assets/css/img/Caio.jpg" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Viviane Soares</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/130721573_2447514392060467_2518719859666796177_o.jpg?_nc_cat=108&ccb=2&_nc_sid=09cbfe&_nc_ohc=mYgZ_iaZMsgAX8OxWrV&_nc_ht=scontent.fcpq4-1.fna&oh=ebed84440b7f479a097acf165ec20a6f&oe=60368BEF" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Carlos augusto</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/48376083_1774848979290448_2227168575674646528_n.jpg?_nc_cat=103&ccb=2&_nc_sid=09cbfe&_nc_ohc=Cl4R69na_vQAX-XXNBd&_nc_ht=scontent.fcpq4-1.fna&oh=076a06f455381386ef3de739dec6d679&oe=6035D944" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Marcus Vinícius</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>

            <div class="contato">
                <img class="foto-contato" src="/app/View/assets/css/img/Caio.jpg" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Caio Brandini</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/130721573_2447514392060467_2518719859666796177_o.jpg?_nc_cat=108&ccb=2&_nc_sid=09cbfe&_nc_ohc=mYgZ_iaZMsgAX8OxWrV&_nc_ht=scontent.fcpq4-1.fna&oh=ebed84440b7f479a097acf165ec20a6f&oe=60368BEF" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Vinícius Venturini</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/48376083_1774848979290448_2227168575674646528_n.jpg?_nc_cat=103&ccb=2&_nc_sid=09cbfe&_nc_ohc=Cl4R69na_vQAX-XXNBd&_nc_ht=scontent.fcpq4-1.fna&oh=076a06f455381386ef3de739dec6d679&oe=6035D944" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Marcus Vinícius</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>

            <div class="contato">
                <img class="foto-contato" src="/app/View/assets/css/img/Caio.jpg" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Caio Brandini</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/130721573_2447514392060467_2518719859666796177_o.jpg?_nc_cat=108&ccb=2&_nc_sid=09cbfe&_nc_ohc=mYgZ_iaZMsgAX8OxWrV&_nc_ht=scontent.fcpq4-1.fna&oh=ebed84440b7f479a097acf165ec20a6f&oe=60368BEF" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Vinícius Venturini</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/48376083_1774848979290448_2227168575674646528_n.jpg?_nc_cat=103&ccb=2&_nc_sid=09cbfe&_nc_ohc=Cl4R69na_vQAX-XXNBd&_nc_ht=scontent.fcpq4-1.fna&oh=076a06f455381386ef3de739dec6d679&oe=6035D944" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Marcus Vinícius</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>

            <div class="contato">
                <img class="foto-contato" src="/app/View/assets/css/img/Caio.jpg" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Caio Brandini</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/130721573_2447514392060467_2518719859666796177_o.jpg?_nc_cat=108&ccb=2&_nc_sid=09cbfe&_nc_ohc=mYgZ_iaZMsgAX8OxWrV&_nc_ht=scontent.fcpq4-1.fna&oh=ebed84440b7f479a097acf165ec20a6f&oe=60368BEF" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Vinícius Venturini</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            
            <div class="contato">
                <img class="foto-contato" src="https://scontent.fcpq4-1.fna.fbcdn.net/v/t1.0-9/48376083_1774848979290448_2227168575674646528_n.jpg?_nc_cat=103&ccb=2&_nc_sid=09cbfe&_nc_ohc=Cl4R69na_vQAX-XXNBd&_nc_ht=scontent.fcpq4-1.fna&oh=076a06f455381386ef3de739dec6d679&oe=6035D944" alt="foto de perfil">
                <div class="contato-info">
                    <span class="contato-name">Marcus Vinícius</span>
                    <p class="contact-last-message">iae</p>
                </div>
            </div>
            


        

        
        <!-- Fim contatos -->
        </div>
    </div>
    <div class="chat">
        <div class="chat-title-container">
            <img class="foto-perfil-contato" src="/app/View/assets/css/img/Caio.jpg" alt="foto perfil contato">
            <p class="nome-contato-chat">Marcus Vinícius</p>
        </div>

        <div class="initial">
            <div class="initial-main">
                <i class="far fa-comment"></i>
                <div class="initial-message"> 
                    <span>Suas mensagens</span> 
                    <p>Envie mensagens diretas para seus amigos</p>
                    <button type="button" class="btn btn-primary">Enviar mensagem</button>
                </div>
            </div>
        </div>

        <div class="chat-right">
            <div class="chat-messages">
                <!-- Mensagens -->

                <div class="my-message">
                    <div class="message-content">
                        <span>oe</span>
                    </div>
                </div>

                <div class="my-message">
                    <div class="message-content">
                        <span>Lorem ipsum dolor sit amet consectetur, adipisicing elit.</span>
                    </div>
                </div>

                <div class="your-message">
                    <div class="message-content">
                        <span>Lorem ipsum dolor sit amet consectetur, adipisicing elit.</span>
                    </div>
                </div>

            </div>
            <div class="chat-bottom">
                <form method="POST" class="d-flex" ajax="true">
                    <input class="form-control" type="text" placeholder="Mensagem...">
                    <button type="submit" class="btn-chat-enviar">Enviar</span>
                </form>
            </div>
        </div>
    </div>
</div>

<script>

    $(".chat-title-container").hide();
    $(".chat-right").hide();

    if(window.matchMedia("(max-width: 975px)").matches){
            $(".chat").hide();
    } 


    //contato slecionado
    $(".contato").click(function(){
        let contato = $(this);
        let imgContato = contato.children(".foto-contato").attr("src");
        let nameContato = contato.children(".contato-info").children(".contato-name").text();
        let listaContatos = $(".contato");


        listaContatos.each(function(){
            if($(this).css("background-color") == "rgb(245, 244, 244)"){
                $(this).css("background-color", "rgb(252, 252, 252)");
                return;
            }
        });

        $(this).css("background-color", "rgb(245, 244, 244)");

        var form_url = $(this).attr("action");

        $(".chat-title-container").html('<img class="foto-perfil-contato" src='+imgContato+' alt="foto perfil contato"><p class="nome-contato-chat">'+nameContato+'</p>');
        $(".chat-title-container").show();
        $(".initial").hide();
        $(".chat-right").show();

        $.ajax({
            url: form_url, 
            method: "POST",
            data: {
                nameOP: $(".nome-contato-chat").text(),
                contactName:"caiobrandini"
            },   
            // dataType: "json",  
            cache: false,
            success: function(resposta){
            }
        });


    });

    $(document).ready(function(e) {
    

    //ao enviar mensagem
    $("form[ajax=true]").submit(function(e) {
        
        e.preventDefault();
        
        var form_data = $(this).serialize();
        let msg = $(".form-control").val();
        var form_url = $(this).attr("action");

        if(msg != "" && msg != " "){
            $.ajax({
            url: form_url, 
            method: "POST",
            data: {
                menssage: msg,
                nameOP: $(".nome-contato-chat").text()
            },   
            // dataType: "json",  
            cache: false,
            success: function(){

                //envia menssagem
                let msg = $(".form-control").val();
                $(".chat-messages").append('<div class="my-message"><div class="message-content"><span>'+htmlEntities(msg)+'</span></div></div>');


                //apagar valor do submit
                $(".form-control").val("");

                let messages = $(".chat-messages").children();
                let lastMessageDiv = messages[messages.length-1];

                let lastMessage = $(".chat-messages").find(lastMessageDiv).find(".message-content span").text();

                let listaContatos = $(".contato");

                listaContatos.each(function(){
                    if($(this).css("background-color") == "rgb(245, 244, 244)"){
                        
                        if(lastMessage.length > 16){
                            lastMessage = lastMessage.slice(0,16) + '...';
                        }

                        $(this).find(".contato-info p").text(lastMessage);
                        return;
                    }
                });
                
                //descer barra do chat
                $(".chat-messages").scrollTop(100000);


                //elevar contato
                listaContatos.each(function(){
                    if($(this).css("background-color") == "rgb(245, 244, 244)"){
                        $(this).remove();
                        $(".contact-list").prepend('<div class="contato" style="background-color: rgb(245, 244, 244)">'+$(this).html()+'</div>');
                    }
                });


            }           
        });    


        
        }

    });
    
});

function htmlEntities(str) {
    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

</script>